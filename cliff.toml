# Git Cliff configuration for PJS (Priority JSON Streaming Protocol)
# Generates changelog entries from conventional commits matching the Keep a Changelog format
# See: https://github.com/orhun/git-cliff

[changelog]
# Header of the changelog file
header = """
# Changelog

<!-- markdownlint-disable MD024 -->

All notable changes to the Priority JSON Streaming Protocol (PJS) project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

"""

# Changelog body template that groups commits by type
body = """
{% if version %}\
## [{{ version }}] - {{ timestamp | date(format="%Y-%m-%d") }}
{% else %}\
## [Unreleased]
{% endif %}\
{% for group, commits in commits | group_by(attribute="group") %}

### {{ group }}
{% for commit in commits %}\
- {% if commit.breaking %}**BREAKING**: {% endif %}{{ commit.message | upper_first }}{% if commit.body %}\n\n{{ commit.body | indent(2) }}{% endif %}
{% endfor %}\
{% endfor %}\
"""

# Footer of the changelog
footer = """
<!-- generated by git-cliff -->
"""

# Whether to trim the changelog
trim = true

[git]
# Use conventional commit format
conventional_commits = true

# Don't filter out non-conventional commits
filter_unconventional = false

# Commit preprocessors
commit_preprocessors = [
  # Remove multiple spaces
  { pattern = '\s+', replace = " " },
  # Remove commit refs at the end
  { pattern = '(#[0-9]+)', replace = "" }
]

# Commit parsers that group commits by type
commit_parsers = [
  # Breaking changes (highest priority)
  { message = "^feat\\!:|^fix\\!:|^refactor\\!:|^perf\\!:", group = "Breaking Changes", skip = false },

  # Features
  { message = "^feat", group = "Features", skip = false },

  # Bug fixes
  { message = "^fix", group = "Bug Fixes", skip = false },

  # Performance improvements
  { message = "^perf", group = "Performance", skip = false },

  # Security updates
  { message = "^security", group = "Security", skip = false },

  # Refactoring
  { message = "^refactor", group = "Refactoring", skip = false },

  # Documentation
  { message = "^docs", group = "Documentation", skip = false },

  # Code style
  { message = "^style", group = "Code Style", skip = false },

  # Testing
  { message = "^test", group = "Testing", skip = false },

  # CI/CD changes
  { message = "^ci", group = "CI/CD", skip = false },

  # Dependency updates
  { message = "^chore\\(deps", group = "Dependency Updates", skip = false },

  # Other chores
  { message = "^chore", group = "Miscellaneous", skip = true },

  # Skip commits that are just reverts or merges
  { message = "^revert", skip = true },
  { message = "^Merge pull request", skip = true }
]

# Protect breaking changes from being skipped
protect_breaking_commits = false

# Don't make commits conventional-only
conventional_only = false

# Version tag pattern (matches v0.1.0, v1.2.3, etc)
tag_pattern = "v[0-9]*"

# Sort commits by oldest first
sort_commits = "oldest"

# Don't limit number of commits
limit_commits = 0
